#!/usr/bin/env bash

# Function to check if a string is an integer
is_integer() {
    [[ "$1" =~ ^[0-9]+$ ]]
}

# Function to validate day input
validate_day() {
    local day=$1
    if [ -z "$day" ]; then
        echo "Error: Day argument is required"
        exit 1
    fi

    if ! is_integer "$day"; then
        echo "Error: Day must be an integer"
        exit 1
    fi

    if (( day < 1 || day > 25 )); then
        echo "Error: Day must be between 1 and 25"
        exit 1
    fi
}

# Get the script directory
SCRIPT_DIR=$(dirname "$(readlink -f "$0")")

# Validate day argument
if [[ $# -eq 0 ]]; then
    echo "Usage: $0 <day>"
    exit 1
fi
validate_day "$1"

# Create paths
CODE_PATH="$SCRIPT_DIR/libs/day$(printf '%02d' "$1")"
DATA_PATH="$SCRIPT_DIR/data/day$(printf '%02d' "$1")"

# Check if paths already exist
if [ -d "$CODE_PATH" ] || [ -d "$DATA_PATH" ]; then
    echo "Error: Directory code or data directory already exists"
    exit 1
fi

# Create directories
mkdir -p "$CODE_PATH" "$DATA_PATH"

# Create templatesPath
TEMPLATES_PATH="$SCRIPT_DIR/data/templates"

# Find all .tmpl files
files=$(find "$TEMPLATES_PATH" -type f -name "*.tmpl")

# Copy .tmpl files to codePath
for file in $files; do
    # Extract filename without directory
    FILE_NAME=$(basename "$file" '.tmpl')

    # Copy the file to the new location
    cp "$file" "$CODE_PATH/$FILE_NAME"
done

# Create input and input_test files in dataPath
touch "$DATA_PATH/input"
touch "$DATA_PATH/input_test"

echo "Directories created successfully:"
echo "$CODE_PATH"
echo "$DATA_PATH"
